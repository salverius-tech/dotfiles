# ~/.zshrc: Zsh configuration managed by chezmoi

# Add ~/bin and ~/.local/bin to PATH
if [ -d "$HOME/bin" ] && [[ ":$PATH:" != *":$HOME/bin:"* ]]; then
    export PATH="$HOME/bin:$PATH"
fi
if [ -d "$HOME/.local/bin" ] && [[ ":$PATH:" != *":$HOME/.local/bin:"* ]]; then
    export PATH="$HOME/.local/bin:$PATH"
fi

# Completion system
autoload -U compinit && compinit

# Load shared aliases
[ -f ~/.shell_aliases ] && source ~/.shell_aliases

# kubectl completion (if available)
if command -v kubectl &> /dev/null; then
    source <(kubectl completion zsh)
fi

# helm completion (if available)
if command -v helm &> /dev/null; then
    source <(helm completion zsh)
fi

# Make autocompletion
zstyle ':completion:*:*:make:*' tag-order 'targets'

# Prompt substitution for git branch
setopt PROMPT_SUBST

# Starship prompt (if available)
export STARSHIP_CONFIG=~/.config/starship.toml
if command -v starship &> /dev/null; then
    eval "$(starship init zsh)"
else
    # Fallback prompt with git branch
    _git_branch() {
        local ref=$(git symbolic-ref --short HEAD 2> /dev/null)
        if [ -n "${ref}" ]; then
            echo "%F{yellow}[%f%F{red}${ref}%f%F{yellow}]%f"
        else
            echo ""
        fi
    }
    PS1='%F{green}%M%f:%F{cyan}%~$(_git_branch)$ '
fi
